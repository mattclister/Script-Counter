import fitz
import re

output = open("output.txt", "w")
textArray = []
start = 8
end = 95
characters = {
    "MALVOLIO": 0,
    "SIR ANDREW AGUECHEEK": 0,
    "SIR TOBY BELCH": 0,
    "MARIA": 0,
    "FOOL": 0,
    "FABIAN": 0,
    "ORSINO": 0,
    "VALENTINE": 0,
    "CURIO": 0,
    "SEBASTIAN": 0,
    "ANTONIO": 0,
    "CAPTAIN": 0,
    "PRIEST": 0,
    "VIOLA": 0,
    "TOBY": 0,
    "ANDREW": 0,
}

exclude_list = [
]

pdf_path = 'twelfth-night.pdf'
document = fitz.open(pdf_path)

for page_num in range(start,end):
    page = document.load_page(page_num)
    text = page.get_text("dict")
    for block in text["blocks"]:
        if "lines" in block:
            for line in block["lines"]:
                for span in line["spans"]:
                    textArray.append([span["text"],span["font"]])

print(textArray)

# Clean Array

cleanArray = []

# Remove Page Numbers

for item in textArray:
    if item[0].isdigit():
        continue
    else:
        cleanArray.append(item)

# Remove Stage Directions

# tempArray = cleanArray
# cleanArray = []

# for item in tempArray:
#     if item[1] == "Helvetica-Oblique":
#         continue
#     else: 
#         cleanArray.append(item)

# Remove Excludes

tempArray = cleanArray
cleanArray = []

for item in tempArray:
    if item[0] in exclude_list:
        continue
    else: 
        cleanArray.append(item)

# Sort text into character arrays

characterLinesArray = []
character = ""
tempCharacterArray = []
for item in cleanArray:
    if character == "" and item[0] in characters:
        character = item[0]
        tempCharacterArray.append(item[0])
        continue
    elif character != "" and item[0] in characters:
        characterLinesArray.append(tempCharacterArray)
        tempCharacterArray = []
        character = item[0]
        tempCharacterArray.append(item[0])
        continue
    elif character == "" and item[0] not in characters:
        continue
    elif character != "" and item[0] not in characters:
        tempCharacterArray.append(item[0])
        continue

# Join Lines
characterLinesArrayJoined = []

for item in characterLinesArray:
    temp = [item[0],(" ".join(item[1:]))]
    temp.append(len((temp[1].split(" "))))
    characterLinesArrayJoined.append(temp)
    
for item in characterLinesArrayJoined:
    output.write(str(item)+"\n")

# Count Lines
for item in characterLinesArrayJoined:
    characters[item[0]] += int(item[2])

output.write(str(characters))

output.close()
